steps:
  metrics-coverage:
    # path to the Dockerfile relative to the root of the git repo
    build: jenkins
    run:
      # /source is always the path to the root of the git repo
      cwd: /source
      env:
        GRADLE_USER_HOME: /root/.gradle
        GRADLE_OPTS: -Dorg.gradle.daemon=false
      files:
        gradle.home: "/root/.gradle:rw"
        maven.home: "/root/.m2:rw"
      cmd: |
        ./gradlew clean build test integrationTest jacocoTestReport sonarRunner -Dsonar.projectName=metrics -Dsonar.branch=$VCSINFO_BRANCH -Dsonar.projectKey=aam:metrics --refresh-dependencies
      artifacts:
        /source/build:
